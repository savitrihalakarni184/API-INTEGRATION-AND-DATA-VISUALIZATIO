import requests
import matplotlib.pyplot as plt

# ✅ Replace with your actual OpenWeatherMap API key
API_KEY = '3c3ab1b75fdd701f26a9da4eae93d50e'
BASE_URL = 'http://api.openweathermap.org/data/2.5/weather'

# 🌍 List of cities to fetch weather data for
cities = ['Delhi', 'Mumbai', 'Bengaluru', 'Chennai', 'Kolkata']

# 📦 Containers for data
temperatures = []
humidities = []

# 🔄 Fetch data from API
for city in cities:
    params = {
        'q': city,
        'appid': API_KEY,
        'units': 'metric'  # Use 'imperial' for Fahrenheit
    }
    response = requests.get(BASE_URL, params=params)
    data = response.json()

    if response.status_code == 200:
        temp = data['main']['temp']
        humidity = data['main']['humidity']
        temperatures.append(temp)
        humidities.append(humidity)
        print(f"{city}: {temp}°C, {humidity}% humidity")
    else:
        print(f"Failed to fetch data for {city}")
        temperatures.append(None)
        humidities.append(None)

# 🎨 Plotting the data
plt.style.use('seaborn-v0_8-whitegrid')  # Use a valid style for your matplotlib version

fig, ax1 = plt.subplots(figsize=(10, 6))

# 🌡 Temperature plot
ax1.set_xlabel('City')
ax1.set_ylabel('Temperature (°C)', color='tab:red')
ax1.plot(cities, temperatures, marker='o', color='tab:red', label='Temperature')
ax1.tick_params(axis='y', labelcolor='tab:red')

# 💧 Humidity plot (secondary axis)
ax2 = ax1.twinx()
ax2.set_ylabel('Humidity (%)', color='tab:blue')
ax2.plot(cities, humidities, marker='s', color='tab:blue', label='Humidity')
ax2.tick_params(axis='y', labelcolor='tab:blue')

# 🏷 Title and layout
plt.title('Current Weather: Temperature & Humidity by City')
fig.tight_layout()
plt.show()
